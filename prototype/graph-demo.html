<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Graph Modules Demo - –î–≤—É—Ö—Å–ª–æ–π–Ω—ã–π –≥—Ä–∞—Ñ —Å –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–µ–π</title>
    <link rel="stylesheet" href="css/styles.css">
    <style>
        .graph-demo-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            padding: 20px;
            background: var(--bg-primary, #0f172a);
        }

        .graph-controls {
            display: flex;
            gap: 20px;
            padding: 20px;
            background: var(--bg-secondary, #1e293b);
            border-radius: 8px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            align-items: center;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .control-group label {
            color: var(--text-primary, #f1f5f9);
            font-size: 14px;
            font-weight: 500;
        }

        .control-group input[type="range"] {
            width: 200px;
        }

        .control-group .value-display {
            color: var(--text-secondary, #94a3b8);
            font-size: 12px;
        }

        .layer-mode-buttons {
            display: flex;
            gap: 10px;
        }

        .layer-mode-btn {
            padding: 8px 16px;
            background: var(--bg-tertiary, #334155);
            color: var(--text-primary, #f1f5f9);
            border: 1px solid var(--border-color, #475569);
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .layer-mode-btn:hover {
            background: var(--bg-hover, #475569);
        }

        .layer-mode-btn.active {
            background: var(--accent-color, #3b82f6);
            border-color: var(--accent-color, #3b82f6);
        }

        .action-button {
            padding: 10px 20px;
            background: var(--accent-color, #3b82f6);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s;
        }

        .action-button:hover {
            background: var(--accent-hover, #2563eb);
        }

        .action-button.secondary {
            background: var(--bg-tertiary, #334155);
        }

        .action-button.secondary:hover {
            background: var(--bg-hover, #475569);
        }

        #graphContainer {
            flex: 1;
            min-height: 500px;
            background: var(--bg-primary, #0f172a);
            border: 1px solid var(--border-color, #475569);
            border-radius: 8px;
            position: relative;
            width: 100%;
            height: 100%;
        }

        .graph-info {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(15, 23, 42, 0.9);
            padding: 10px 15px;
            border-radius: 4px;
            color: var(--text-primary, #f1f5f9);
            font-size: 12px;
            z-index: 10;
        }

        .graph-info-item {
            margin: 4px 0;
        }

        .legend {
            display: flex;
            gap: 20px;
            padding: 10px;
            background: var(--bg-secondary, #1e293b);
            border-radius: 4px;
            margin-top: 10px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--text-primary, #f1f5f9);
            font-size: 12px;
        }

        .legend-color {
            width: 20px;
            height: 3px;
            border-radius: 2px;
        }

        .legend-color.layer1 {
            background: #3b82f6;
        }

        .legend-color.layer2 {
            background: #10b981;
            border-style: dashed;
        }
    </style>
</head>
<body>
    <div class="graph-demo-container">
        <h1 style="color: var(--text-primary, #f1f5f9); margin-bottom: 20px;">
            –î–≤—É—Ö—Å–ª–æ–π–Ω—ã–π –≥—Ä–∞—Ñ —Å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–π –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–µ–π
        </h1>

        <div class="graph-controls">
            <div class="control-group">
                <label>–£—Ä–æ–≤–µ–Ω—å –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏</label>
                <input type="range" id="clusterLevelSlider" min="0" max="1" step="0.01" value="0.5">
                <span class="value-display" id="clusterLevelValue">50%</span>
            </div>

            <div class="control-group">
                <label>–†–µ–∂–∏–º —Å–ª–æ—è</label>
                <div class="layer-mode-buttons">
                    <button class="layer-mode-btn active" data-mode="combined">–û–±–∞ —Å–ª–æ—è</button>
                    <button class="layer-mode-btn" data-mode="layer1">–°–ª–æ–π 1 (–ø–æ—Ö–æ–∂–µ—Å—Ç—å)</button>
                    <button class="layer-mode-btn" data-mode="layer2">–°–ª–æ–π 2 (NER)</button>
                </div>
            </div>

            <div class="control-group">
                <label>–î–µ–π—Å—Ç–≤–∏—è</label>
                <div style="display: flex; gap: 10px;">
                    <button class="action-button secondary" id="declusterBtn">–î–µ–∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è</button>
                    <button class="action-button secondary" id="fullDeclusterBtn">–ü–æ–ª–Ω–∞—è –¥–µ–∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è</button>
                </div>
            </div>
        </div>

        <div id="graphContainer">
            <div class="graph-info" id="graphInfo">
                <div class="graph-info-item">–£–∑–ª–æ–≤: <span id="nodeCount">0</span></div>
                <div class="graph-info-item">–°–≤—è–∑–µ–π —Å–ª–æ–π 1: <span id="layer1Count">0</span></div>
                <div class="graph-info-item">–°–≤—è–∑–µ–π —Å–ª–æ–π 2: <span id="layer2Count">0</span></div>
                <div class="graph-info-item">–ö–ª–∞—Å—Ç–µ—Ä–æ–≤: <span id="clusterCount">0</span></div>
            </div>
        </div>

        <div class="legend">
            <div class="legend-item">
                <div class="legend-color layer1"></div>
                <span>–°–ª–æ–π 1: –°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∞—è –ø–æ—Ö–æ–∂–µ—Å—Ç—å</span>
            </div>
            <div class="legend-item">
                <div class="legend-color layer2"></div>
                <span>–°–ª–æ–π 2: –û–±—â–∏–µ NER (–∞–∫—Ç–æ—Ä—ã)</span>
            </div>
            <div class="legend-item">
                <span>üí° –ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ —É–∑–µ–ª –¥–ª—è –≤—ã–±–æ—Ä–∞, –∑–∞—Ç–µ–º –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–ª–∞–π–¥–µ—Ä –¥–ª—è –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏</span>
            </div>
            <div class="legend-item" style="color: var(--text-muted, #9ca3af); font-size: 11px;">
                ‚ö†Ô∏è –í–∞–∂–Ω–æ: –ó–∞–ø—É—Å—Ç–∏—Ç–µ —á–µ—Ä–µ–∑ –ª–æ–∫–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä (python -m http.server 8000)
            </div>
        </div>
    </div>

    <!-- Cytoscape.js –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –≥—Ä–∞—Ñ–æ–≤ -->
    <script src="https://unpkg.com/cytoscape@3.27.0/dist/cytoscape.min.js"></script>
    
    <!-- –ó–∞–≥—Ä—É–∑–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Å–∫—Ä–∏–ø—Ç–æ–≤ -->
    <script src="js/app.js"></script>
    
    <!-- –ù–æ–≤—ã–µ –º–æ–¥—É–ª–∏ –≥—Ä–∞—Ñ–∞ -->
    <script src="js/graph-processor.js"></script>
    <script src="js/graph-renderer-cytoscape.js"></script>
    <script src="js/graph-example.js"></script>

    <script>
        let graphModules = null;

        // –ü—Ä–æ–≤–µ—Ä–∫–∞, –∑–∞–ø—É—â–µ–Ω –ª–∏ —á–µ—Ä–µ–∑ HTTP —Å–µ—Ä–≤–µ—Ä
        function checkServerMode() {
            if (window.location.protocol === 'file:') {
                const errorMsg = document.createElement('div');
                errorMsg.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    right: 0;
                    background: #ef4444;
                    color: white;
                    padding: 20px;
                    text-align: center;
                    z-index: 10000;
                    font-weight: bold;
                `;
                errorMsg.innerHTML = `
                    ‚ö†Ô∏è –û–®–ò–ë–ö–ê: –§–∞–π–ª –æ—Ç–∫—Ä—ã—Ç —á–µ—Ä–µ–∑ file:// –ø—Ä–æ—Ç–æ–∫–æ–ª<br>
                    –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ª–æ–∫–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –≥—Ä–∞—Ñ–æ–º:<br>
                    <code style="background: rgba(0,0,0,0.3); padding: 5px 10px; border-radius: 4px; margin: 10px;">
                        cd prototype && python -m http.server 8000
                    </code><br>
                    –ó–∞—Ç–µ–º –æ—Ç–∫—Ä–æ–π—Ç–µ: <code style="background: rgba(0,0,0,0.3); padding: 5px 10px; border-radius: 4px;">http://localhost:8000/graph-demo.html</code>
                `;
                document.body.insertBefore(errorMsg, document.body.firstChild);
                return false;
            }
            return true;
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö
        async function init() {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∂–∏–º –∑–∞–ø—É—Å–∫–∞
            if (!checkServerMode()) {
                return;
            }

            console.log('–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...');
            try {
                const loaded = await loadData();
                
                if (loaded && window.AppData) {
                    console.log('–î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã:', {
                        posts: window.AppData.posts.length,
                        actors: window.AppData.actors.length,
                        relationships: window.AppData.relationships.length
                    });

                    console.log('–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–æ–¥—É–ª–µ–π –≥—Ä–∞—Ñ–∞...');
                    graphModules = initGraphModules();
                    
                    if (graphModules && graphModules.graph) {
                        // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≥—Ä–∞—Ñ–µ
                        updateGraphInfo(graphModules.graph);
                        
                        // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –≥—Ä–∞—Ñ–∞
                        window.addEventListener('graphUpdated', (e) => {
                            updateGraphInfo(e.detail.graph);
                        });
                    } else {
                        console.error('–ù–µ —É–¥–∞–ª–æ—Å—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –º–æ–¥—É–ª–∏ –≥—Ä–∞—Ñ–∞');
                        showError('–ù–µ —É–¥–∞–ª–æ—Å—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –≥—Ä–∞—Ñ. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –¥–ª—è –¥–µ—Ç–∞–ª–µ–π.');
                    }
                } else {
                    console.error('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ');
                    showError('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ñ–∞–π–ª—ã –¥–∞–Ω–Ω—ã—Ö –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ –ø–∞–ø–∫–µ data/');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:', error);
                showError('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ: ' + error.message);
            }
        }

        function showError(message) {
            const errorDiv = document.createElement('div');
            errorDiv.style.cssText = `
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: rgba(239, 68, 68, 0.9);
                color: white;
                padding: 20px 30px;
                border-radius: 8px;
                text-align: center;
                z-index: 1000;
                max-width: 500px;
            `;
            errorDiv.textContent = message;
            document.getElementById('graphContainer').appendChild(errorDiv);
        }

        function updateGraphInfo(graph) {
            if (!graph || !graph.metadata) return;
            
            document.getElementById('nodeCount').textContent = graph.metadata.totalNodes || 0;
            document.getElementById('layer1Count').textContent = graph.metadata.layer1Connections || 0;
            document.getElementById('layer2Count').textContent = graph.metadata.layer2Connections || 0;
            document.getElementById('clusterCount').textContent = graph.metadata.totalClusters || 0;
        }

        // –ó–∞–ø—É—Å–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }
    </script>
</body>
</html>

